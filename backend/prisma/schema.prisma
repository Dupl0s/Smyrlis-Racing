generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id                String   @id @default(cuid())
  name              String
  type              String   // "QUALI" or "RACE"
  date              DateTime
  createdAt         DateTime @default(now())

  results           Result[]
  laps              Lap[]
  sectorTimes       SectorTime[]
  pitStops          PitStop[]
}

model Driver {
  id                String   @id @default(cuid())
  startNumber       Int
  firstName         String
  lastName          String
  nationality       String?
  createdAt         DateTime @default(now())

  results           Result[]
  laps              Lap[]
  sectorTimes       SectorTime[]

  @@index([startNumber])
}

model Team {
  id                String   @id @default(cuid())
  name              String   @unique
  createdAt         DateTime @default(now())

  results           Result[]
  vehicles          Vehicle[]
  pitStops          PitStop[]
}

model Vehicle {
  id                String   @id @default(cuid())
  model             String
  vehicleClass      String
  teamId            String
  createdAt         DateTime @default(now())

  team              Team     @relation(fields: [teamId], references: [id])
  results           Result[]
  laps              Lap[]
  sectorTimes       SectorTime[]
}

model Result {
  id                String   @id @default(cuid())
  sessionId         String
  driverId          String
  teamId            String
  vehicleId         String
  startNumber       Int
  position          Int?
  laps              Int?
  totalTime         Float?   // in seconds
  gap               String?
  interval          String?
  bestLapTime       Float?   // in seconds
  bestLapNumber     Int?
  status            String?
  createdAt         DateTime @default(now())

  session           Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  driver            Driver   @relation(fields: [driverId], references: [id])
  team              Team     @relation(fields: [teamId], references: [id])
  vehicle           Vehicle  @relation(fields: [vehicleId], references: [id])

  @@index([sessionId])
  @@index([driverId])
  @@index([startNumber])
}

model Lap {
  id                String   @id @default(cuid())
  sessionId         String
  driverId          String
  vehicleId         String
  startNumber       Int
  lapNumber         Int
  lapTime           Float    // in seconds
  createdAt         DateTime @default(now())

  session           Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  driver            Driver   @relation(fields: [driverId], references: [id])
  vehicle           Vehicle  @relation(fields: [vehicleId], references: [id])

  @@index([sessionId])
  @@index([driverId])
  @@index([startNumber])
}

model SectorTime {
  id                String   @id @default(cuid())
  sessionId         String
  driverId          String
  vehicleId         String
  startNumber       Int
  lapNumber         Int
  sector1           Float?   // in seconds
  sector2           Float?   // in seconds
  sector3           Float?   // in seconds
  sector4           Float?   // in seconds
  sector5           Float?   // in seconds
  createdAt         DateTime @default(now())

  session           Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  driver            Driver   @relation(fields: [driverId], references: [id])
  vehicle           Vehicle  @relation(fields: [vehicleId], references: [id])

  @@index([sessionId])
  @@index([driverId])
  @@index([startNumber])
}

model PitStop {
  id                String   @id @default(cuid())
  sessionId         String
  teamId            String
  startNumber       Int
  lapNumber         Int       // The lap where the pit stop occurred
  duration          Float?    // Duration of pit stop in seconds
  createdAt         DateTime @default(now())

  session           Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  team              Team     @relation(fields: [teamId], references: [id])

  @@index([sessionId])
  @@index([teamId])
  @@index([startNumber])
}
